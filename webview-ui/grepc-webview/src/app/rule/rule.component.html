<div #container class="rule-container">
    <form [formGroup]="ruleForm">
        <header class="rule-header" (click)="toggleExpand($event)">

            <div class="rule-header-container">
                <div
                    (mousedown)="mouseDown()"
                    [ngClass]="this.gripperClass"
                    class="gripper codicon codicon-gripper">
                </div>
                <div
                    (click)="toggleExpand($event)"
                    [ngClass]="this.rule.expanded ? 'open' : 'closed'" 
                    class="drop-down codicon codicon-chevron-right">
                </div>
                <span
                    *ngIf="!this.isEditingTitle"
                    (click)="toggleExpand($event)"
                    (mouseenter)="showEditIcon = true"
                    (mouseleave)="showEditIcon = false"
                    class="rule-id center-vertical">
                    {{rule.title}}
                    <div
                        (click)="toggleEditTitle()"
                        [ngClass]="this.showEditIcon ? 'editing' : 'fixed'"
                        class="codicon codicon-edit clickable">
                    </div>
                </span>
                <div *ngIf="this.isEditingTitle">
                    <input
                        class="rule-id-input"
                        type="text"
                        (focus)="onFormFocus()"
                        (blur)="onFormBlur()"
                        formControlName="title"/>
                    <div
                        (click)="toggleEditTitle(); toggleShowEditIcon()"
                        class="codicon codicon-close clickable">
                    </div>
                    <div
                        (click)="updateTitle(); toggleEditTitle(); toggleShowEditIcon()"
                        class="codicon codicon-check clickable">
                    </div>
                </div>
            </div>
            
            <div class="rule-header-controls center-vertical">
                <div class="center-vertical control-gap">
                    <span *ngIf="this.rule.enabled" class="circle">
                        {{ this.rule.occurrences }}
                    </span>
                    <app-slider-checkbox
                        [(value)]="!!this.rule.enabled"
                        [control]="this.ruleForm.controls['enabled']">
                    </app-slider-checkbox>
                </div>
                <span 
                    class="delete-rule codicon codicon-trash"
                    (click)="deleteSelf()">
                </span>
            </div>
        </header>
    
        <content [style.display]="getExpandedStyle(this.rule.expanded)" class="rule-body">
            <input
                formControlName="regularExpression"
                (focus)="onFormFocus()"
                (blur)="onFormBlur()"
                type="text" class="regex-input" placeholder="Regular Expression"/>
            <input
                formControlName="includedFiles"
                (focus)="onFormFocus()"
                (blur)="onFormBlur()"
                type="text" name="include-files" placeholder="Include Files"/>
            <input
                formControlName="excludedFiles"
                (focus)="onFormFocus()"
                (blur)="onFormBlur()"
                type="text" name="exclude-files" placeholder="Exclude Files"/>
    
            <div class="decoration-container">
                <header class="decoration-header" (click)="toggleDecorationExpanded($event)">
                    <div class="rule-header-container">
                        <div
                            (click)="toggleDecorationExpanded($event)"
                            [ngClass]="this.rule.decorationExpanded ? 'open' : 'closed'" 
                            class="drop-down codicon codicon-chevron-right">
                        </div>
        
                        <span class="rule-id" (click)="toggleDecorationExpanded($event)">
                            Decorations
                        </span>
                    </div>
        
                </header>
        
                <content class="decoration-body" [style.display]="getExpandedStyle(this.rule.decorationExpanded)">
                    <div class="block">
                        <label>
                            background color:
                        </label>   
                        <input
                            formControlName="backgroundColor"
                            [value]="this.rule.backgroundColor"
                            [style.background]="this.rule.backgroundColor"
                            [(colorPicker)]="this.rule.backgroundColor!"
                            (colorPickerChange)="updateColorPicker('backgroundColor', $event)"/>
                    </div>
                    <div class="input-label">
                        <label>
                            color:
                        </label>
                        <input 
                            formControlName="color"
                            type="text" name="include-files" placeholder="Color"
                            [value]="this.rule.color"
                            [style.background]="this.rule.color"
                            [(colorPicker)]="this.rule.color!"
                            (colorPickerChange)="updateColorPicker('color', $event)"/>
                    </div>
                    <div class="input-label">
                        <label>
                            outline:
                        </label>
                        <input
                            formControlName="outline" 
                            (focus)="onFormFocus()"
                            (blur)="onFormBlur()"
                            type="text" name="outline" placeholder="Outline"/>
                    </div>
                    <div class="input-label">
                        <label>
                            outline color:
                        </label>
                        <input
                            formControlName="outlineColor" 
                            type="text" name="include-files" placeholder="Outline Color"
                            [value]="this.rule.outlineColor"
                            [style.background]="this.rule.outlineColor"
                            [(colorPicker)]="this.rule.outlineColor!"
                            (colorPickerChange)="updateColorPicker('outlineColor', $event)"/>
                    </div>
                    <div class="input-label">
                        <label>
                            outline width:
                        </label>
                        <input
                            formControlName="outlineWidth"
                            (focus)="onFormFocus()"
                            (blur)="onFormBlur()"
                            type="text" name="include-files" placeholder="Outline Width"
                            [(value)]="this.rule.outlineWidth"/>
                    </div>            
                    <div class="input-label">
                        <label>
                            border:
                        </label>
                        <input 
                            formControlName="border"
                            (focus)="onFormFocus()"
                            (blur)="onFormBlur()"
                            type="text" name="border" placeholder="Border"
                            [(value)]="this.rule.border"/>
                    </div>     
                    <div class="input-label">
                        <label>
                            border color:
                        </label>
                        <input 
                            formControlName="borderColor"
                            type="text" name="border-color" placeholder="Border Color"
                            [value]="this.rule.borderColor"
                            [style.background]="this.rule.borderColor"
                            [(colorPicker)]="this.rule.borderColor!"
                            (colorPickerChange)="updateColorPicker('borderColor', $event)"/>
                    </div>  
                    <div class="input-label">
                        <label>
                            border width:
                        </label>
                        <input 
                            formControlName="borderWidth"
                            (focus)="onFormFocus()"
                            (blur)="onFormBlur()"
                            type="text" name="border-width" placeholder="Border Width"
                            [(value)]="this.rule.borderWidth"/>
                    </div>         
                    <div class="input-label">
                        <label>
                            font style:
                        </label>
                        <input
                            formControlName="fontStyle"
                            (focus)="onFormFocus()"
                            (blur)="onFormBlur()"
                            type="text" name="font-style" placeholder="Font Style"
                            [(value)]="this.rule.fontStyle"/>
                    </div>
                    <div class="input-label">
                        <label>
                            font weight:
                        </label>
                        <input
                            formControlName="fontWeight"
                            (focus)="onFormFocus()"
                            (blur)="onFormBlur()"
                            type="text" name="font-weight" placeholder="Font Weight"
                            [(value)]="this.rule.fontWeight"/>
                    </div>                
                    <div class="input-label">
                        <label>
                            text decoration:
                        </label>
                        <input 
                            formControlName="textDecoration"
                            (focus)="onFormFocus()"
                            (blur)="onFormBlur()"
                            type="text" name="text-decoration" placeholder="Text Decoration"
                            [(value)]="this.rule.textDecoration"/>
                    </div>            
                    <div class="input-label">
                        <label>
                            cursor:
                        </label>
                        <input 
                            formControlName="cursor"
                            (focus)="onFormFocus()"
                            (blur)="onFormBlur()"
                            type="text" name="cursor" placeholder="Cursor"
                            [(value)]="this.rule.cursor"/>
                    </div>
                    <div class="input-label">
                        <label>
                            overview ruler color:
                        </label>
                        <input 
                            formControlName="overviewRulerColor"
                            type="text" name="overview-ruler-color" placeholder="Overview Ruler Color"
                            [value]="this.rule.overviewRulerColor"
                            [style.background]="this.rule.overviewRulerColor"
                            [(colorPicker)]="this.rule.overviewRulerColor!"
                            (colorPickerChange)="updateColorPicker('overviewRulerColor', $event)"/>
                    </div>
                    <div class="input-label">
                        <label>
                            overview ruler lane:
                        </label>
                        <select
                            formControlName="overviewRulerLane">
                            <option value="7" selected>Full</option>
                            <option value="1">Left</option>
                            <option value="2">Center</option>
                            <option value="4">Right</option>
                        </select>
                    </div>
                    <div class="input-checkbox">
                        <label>
                            Is Whole Line?
                        </label>
                        <input type="checkbox"
                            formControlName="isWholeLine"/>
                    </div>    
                </content>
            </div>
        </content>
    </form>
</div>
